/*!
 * Miniscroll small plugin of scrollbar desktop and mobile
 *
 * @author Roger Luiz <http://rogerluizm.com.br/>
 *					  <http://miniscroll.rogerluizm.com.br>
 *
 * @copyright (c) 2011, 2012 <http://rogerluizm.com.br/>
 *
 * @version 1.2.9
 *		update 1.2.9 | 10/09/2013 - fix multidimensional scrollwheel
 *		update 1.2.9 | 10/09/2013 - fix error in the scroll when the position is relative or absolute
 *		update 1.2.9 | 10/09/2013 - fix updating on the x axis
 *		update 1.2.8 | 03/09/2013 - add turn off mousewheel, ex: { mousewheel: true }
 *		update 1.2.7 | 03/09/2013 - add scrollTo, now its posible scroll to a custom position
 *		update 1.2.6 | 21/06/2013 - fix bug the whole scrollbar (not just the handler part) moves down when I drag it.
 *		update 1.2.5 | 18/05/2013 - fix bug thumb position with arrow keys
 * 		update 1.2.4 | 18/05/2013 - fix error it's time to catching the width and height
 * 		update 1.2.3 | 18/05/2013 - fix scrollbar position "x"
 * 		update 1.2.2 | 17/05/2013 - Key event added, now you can press the key down and key up for scrolling
 * 		update 1.2.1 | 15/05/2013 - Touch event added, now works for ipad, iphone and android
 */
(function(e,t,n){var r={touchEvents:"ontouchstart"in t.documentElement},i=function(e,t){this.type="";this.is="static";this.target=this.getElement(e);this.container;this.tracker;this.thumb;this.thumb_delta=new s(0,0);this.thumb_pos=new s(0,0);this.touch=new s(0,0);this.settings=t;this.percent;this.keypos_thumb=new s(0,0);this.scrolling=false;this.preventScrolling=false;this.turnOffWheel=true;this.initializing()},s=function(e,t){this.x=e!=null?e:0;this.y=t!=null?t:0;return{x:this.x,y:this.y}};i[n].initializing=function(){this.buildScrollbar();this.buildScrollbarTracker();this.buildScrolbarThumb();this.settings.isKeyEvent=typeof this.settings.isKeyEvent==="undefined"?true:this.settings.isKeyEvent;this.turnOffWheel=typeof this.settings.turnOffWheel==="undefined"?this.turnOffWheel:this.settings.turnOffWheel;if(this.settings.isKeyEvent)this.addKeyBoardEvent();!r.touchEvents?this.setupEventHandler():this.setupTouchEvent();var t=this;e.setInterval(function(){t.update()},10)};i[n].buildScrollbar=function(){var e=this.target.id?this.target.id:this.target.className;this.container=this.create(this.target,"div",{"class":"miniscroll-container",id:"miniscroll-"+e});var t=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).height;var n=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).width;var r=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size);var i=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{position:"absolute",visibility:"hidden",width:(this.settings.axis==="x"?n:this.settings.size)+"px",height:(this.settings.axis==="y"?t:this.settings.size)+"px",top:(this.settings.axis==="y"?this.offset(this.target).top:i)+"px",left:(this.settings.axis==="x"?this.offset(this.target).left:r)+"px",zIndex:999})};i[n].buildScrollbarTracker=function(){this.tracker=this.create(this.container,"div",{"class":"miniscroll-tracker"});var e=this.settings.axis==="x"?this.offset(this.container).width:this.settings.size;var t=this.settings.axis==="y"?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:e+"px",height:t+"px",backgroundColor:this.settings.trackerColor?this.settings.trackerColor:"#067f41"})};i[n].buildScrolbarThumb=function(){this.thumb=this.create(this.container,"div",{"class":"miniscroll-thumb"});var e=new s(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight);var e=new s(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight);var t=new s(this.settings.sizethumb===undefined||this.settings.sizethumb==="auto"?e.x:this.settings.sizethumb,this.settings.sizethumb===undefined||this.settings.sizethumb==="auto"?e.y:this.settings.sizethumb);this.css(this.thumb,{position:"absolute",top:0+"px",left:0+"px",width:(this.settings.axis==="x"?t.x:this.settings.size)+"px",height:(this.settings.axis==="y"?t.y:this.settings.size)+"px",backgroundColor:this.settings.thumbColor?this.settings.thumbColor:"#2AD47D"})};i[n].setupEventHandler=function(){this.bind(this.thumb,"mousedown",this.onScrollThumbPress);this.bind(this.tracker,"mousedown",this.onScrollTrackerPress);if(this.turnOffWheel){this.bind(this.target,"mousewheel",this.onScrollThumbWheel)}};i[n].setupTouchEvent=function(){this.bind(this.target,"touchstart",this.onScrollTouchStart);this.bind(this.target,"touchmove",this.onScrollTouchMove)};i[n].updateContainerPosition=function(){this.is=this.getCss(this.target,"position");if(this.is==="relative"||this.is==="absolute"){if(this.settings.axis==="y"){this.container.style.top=this.target.scrollTop+"px";this.container.style.left=this.offset(this.target).width-this.settings.size+"px"}else{this.container.style.top=this.offset(this.target).height-this.settings.size+"px";this.container.style.left=this.target.scrollLeft+"px"}}else{if(this.settings.axis==="y"){this.container.style.top=this.offset(this.target).top+"px"}else{this.container.style.left=this.offset(this.target).left+"px"}}};i[n].setScrubPosition=function(e){var t=this.offset(this.container).width,n=this.offset(this.container).height;var r=this.offset(this.thumb).width,i=this.offset(this.thumb).height;this.thumb_pos=new s(Math.round((t-r)*e),Math.round((n-i)*e));if(this.settings.axis==="y"){this.thumb.style.top=Math.round(this.thumb_pos.y)+"px"}else{this.thumb.style.left=Math.round(this.thumb_pos.x)+"px"}};i[n].addKeyBoardEvent=function(){this.target.setAttribute("tabindex","-1");this.css(this.target,{outline:"none"});this.bind(this.target,"focus",function(e,t){this.bind(t,"keydown",function(e){var t=e.keyCode||e.which,n={left:37,up:38,right:39,down:40};switch(t){case n.up:if(this.percent!==0)this.keypos_thumb.y-=10;break;case n.down:if(this.percent!==1)this.keypos_thumb.y+=10;break;case n.left:if(this.percent!==0)this.keypos_thumb.x-=10;break;case n.right:if(this.percent!==1)this.keypos_thumb.x+=10;break}if(this.settings.axis==="y"){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);this.setScrubPosition(this.percent);this.target.scrollTop=this.keypos_thumb.y}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);this.setScrubPosition(this.percent);this.target.scrollLeft=this.keypos_thumb.x}if(this.percent>=1||this.percent<=0){this.preventScrolling=true}else{this.preventScrolling=false}this.updateContainerPosition()})});this.bind(this.target,"click",function(e,n){t.activeElement=n;n.focus()})};i[n].onScrollTouchStart=function(e){var t=e.touches[0];this.scrolling=true;this.touch=new s(t.pageX,t.pageY);this.bind(this.target,"touchend",this.onScrollTouchEnd)};i[n].onScrollTouchMove=function(e){var t=e.touches[0];e.preventDefault();var n=new s(this.touch.x-t.pageX,this.touch.y-t.pageY);this.touch=new s(t.pageX,t.pageY);if(this.settings.axis==="y"){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);this.setScrubPosition(this.percent);this.target.scrollTop=this.target.scrollTop+n.y}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);this.setScrubPosition(this.percent);this.target.scrollLeft=this.target.scrollLeft+n.x}this.updateContainerPosition()};i[n].onScrollTouchEnd=function(e){this.scrolling=false;this.unbind(this.target,"touchend",this.onScrollTouchEnd)};i[n].onScrollThumbPress=function(n){n=n?n:e.event;this.stopEvent(n);this.scrolling=true;this.thumb_delta=new s(this.thumb_pos.x-this.mouse(n).x,this.thumb_pos.y-this.mouse(n).y);this.bind(t,"mousemove",this.onScrollThumbUpdate);this.bind(t,"mouseup",this.onScrollThumbRelease);this.updateContainerPosition()};i[n].onScrollThumbUpdate=function(t){t=t?t:e.event;this.stopEvent(t);if(!this.scrolling)return false;this.thumb_pos=new s(this.mouse(t).x+this.thumb_delta.x,this.mouse(t).y+this.thumb_delta.y);this.thumb_pos=new s(Math.max(0,Math.min(this.container.offsetWidth-this.thumb.offsetWidth,this.thumb_pos.x)),Math.max(0,Math.min(this.container.offsetHeight-this.thumb.offsetHeight,this.thumb_pos.y)));this.percent=new s(this.thumb_pos.x/(this.container.offsetWidth-this.thumb.offsetWidth),this.thumb_pos.y/(this.container.offsetHeight-this.thumb.offsetHeight));this.percent=new s(Math.max(0,Math.min(1,this.percent.x)),Math.max(0,Math.min(1,this.percent.y)));if(this.settings.axis==="y"){this.thumb.style.top=Math.round(this.thumb_pos.y)+"px";this.target.scrollTop=Math.round((this.target.scrollHeight-this.target.offsetHeight)*this.percent.y)}else{this.thumb.style.left=Math.round(this.thumb_pos.x)+"px";this.target.scrollLeft=Math.round((this.target.scrollWidth-this.target.offsetWidth)*this.percent.x)}this.keypos_thumb=new s(this.target.scrollLeft,this.target.scrollTop);this.updateContainerPosition()};i[n].onScrollThumbWheel=function(t){t=t?t:e.event;if(!this.preventScrolling)this.stopEvent(t);var n=t||e.event,r=[].slice.call(arguments,1),i=0,o=true,u=0,a=0;if(n.wheelDelta){i=n.wheelDelta/120}if(n.detail){i=-n.detail/3}a=i;u=i;if(n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS){a=0;u=-1*i}if(n.wheelDeltaY!==undefined){a=n.wheelDeltaY/120}if(n.wheelDeltaX!==undefined){u=-1*n.wheelDeltaX/120}if(this.settings.axis==="y"){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);this.setScrubPosition(this.percent);this.target.scrollTop=Math.round(this.target.scrollTop-a*10)}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);this.setScrubPosition(this.percent);this.target.scrollLeft=Math.round(this.target.scrollLeft-u*10)}if(this.percent>=1||this.percent<=0){this.preventScrolling=true}else{this.preventScrolling=false}this.keypos_thumb=new s(this.target.scrollLeft,this.target.scrollTop);this.updateContainerPosition()};i[n].onScrollThumbRelease=function(n){n=n?n:e.event;this.stopEvent(n);this.scrolling=false;this.unbind(t,"mousemove",this.onScrollThumbUpdate);this.unbind(t,"mouseup",this.onScrollThumbRelease)};i[n].onScrollTrackerPress=function(e){var t=this.mouse(e).y-this.offset(this.container).top;this.scrolling=true;this.scrollTo(t)};i[n].scrollTo=function(e){var t=Math.max(0,Math.min(this.offset(this.target).height-this.offset(this.thumb).height,e));if(this.settings.axis==="y"){this.thumb_pos.y=t;this.thumb.style.top=Math.round(this.thumb_pos.y)+"px";this.target.scrollTop=t;this.scrolling=false}};i[n].update=function(){if(this.settings.axis==="y"){if(this.target.scrollHeight===this.offset(this.target).height){this.css(this.container,{visibility:"hidden"})}else{this.css(this.container,{visibility:"visible"})}}else{if(this.target.scrollWidth===this.offset(this.target).width){this.css(this.container,{visibility:"hidden"})}else{this.css(this.container,{visibility:"visible"})}}var e=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).height;var t=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).width;var n=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size);var r=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{width:(this.settings.axis==="x"?t:this.settings.size)+"px",height:(this.settings.axis==="y"?e:this.settings.size)+"px",top:(this.settings.axis==="y"?this.offset(this.target).top:r)+"px",left:(this.settings.axis==="x"?this.offset(this.target).left:n)+"px"});var i=this.settings.axis==="x"?this.offset(this.container).width:this.settings.size;var o=this.settings.axis==="y"?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:i+"px",height:o+"px"});var u=new s(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight);var a=new s(this.settings.sizethumb===undefined||this.settings.sizethumb==="auto"?u.x:this.settings.sizethumb,this.settings.sizethumb===undefined||this.settings.sizethumb==="auto"?u.y:this.settings.sizethumb);this.css(this.thumb,{width:(this.settings.axis==="x"?a.x:this.settings.size)+"px",height:(this.settings.axis==="y"?a.y:this.settings.size)+"px"});if(this.settings.axis==="y"){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);if(!this.scrolling){this.setScrubPosition(this.percent)}}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);if(!this.scrolling){this.setScrubPosition(this.percent)}}this.updateContainerPosition()};i[n].getElement=function(n){var r,i=this;if(n===e||n===t||n==="body"||n==="body, html"){return t.body}if(typeof n==="string"||n instanceof String){var s=n.replace(/^\s+/,"").replace(/\s+$/,""),r;if(s.indexOf("#")>-1){this.type="id";var o=s.split("#");r=t.getElementById(o[1])}if(s.indexOf(".")>-1){this.type="class";var o=s.split("."),u=t.getElementsByTagName("*"),a=u.length,f=[],l=0;for(var c=0;c<a;c++){if(u[c].className&&u[c].className.match(new RegExp("(^|\\s)"+o[1]+"(\\s|$)"))){r=u[c]}}}return r}else{return n}};i[n].create=function(e,n,r){var i=t.createElement(n);if(r){for(var s in r){if(r.hasOwnProperty(s)){i.setAttribute(s,r[s])}}e.appendChild(i)}return i};i[n].css=function(e,t){for(var n in t){if(n==="opacity"){e.style.filter="alpha(opacity="+t[n]*100+")";e.style.KhtmlOpacity=t[n];e.style.MozOpacity=t[n];e.style.opacity=t[n]}else{e.style[n]=t[n]}}};i[n].getCss=function(n,r){var i;if(!e.getComputedStyle){if(t.defaultView&&t.defaultView.getComputedStyle){i=t.defaultView.getComputedStyle.getPropertyValue(r)}else{if(n.currentStyle){i=n.currentStyle[r]}else{i=n.style[r]}}}else{i=e.getComputedStyle(n).getPropertyValue(r)}return i};i[n].offset=function(e){var t=e.offsetTop,n=e.offsetLeft;var r=e.offsetHeight;if(typeof e.offsetHeight==="undefined"){r=parseInt(this.getCss(e,"height"))}var i=e.offsetWidth;if(typeof e.offsetWidth==="undefined"){i=parseInt(this.getCss(e,"width"))}return{top:t,left:n,width:i,height:r}};i[n].mouse=function(e){var n=0,r=0;if(e.pageX||e.pageY){n=e.pageX;r=e.pageY}else if(e.clientX||e.clientY){n=e.clientX+t.body.scrollLeft+t.documentElement.scrollLeft;r=e.clientY+t.body.scrollTop+t.documentElement.scrollTop}return{x:n,y:r}};i[n].bind=function(e,t,n){var r=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";var i=this;if(e.addEventListener){if(t==="mousewheel"){e.addEventListener(r,function(e){n.call(i,e,this)},false)}else{e.addEventListener(t,function(e){n.call(i,e,this)},false)}}else if(e.attachEvent){e.attachEvent("on"+t,function(e){n.call(i,e,this)})}else{e["on"+t]=function(e){n.call(i,e,this)}}};i[n].unbind=function(e,t,n){var r=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";if(e.addEventListener){if(t==="mousewheel"){e.removeEventListener(r,function(e){n.call(_this,e,this)},false)}else{e.removeEventListener(t,function(e){n.call(_this,e,this)},false)}}else if(e.attachEvent){e.detachEvent("on"+t,function(e){n.call(_this,e,this)})}else{e["on"+t]=null}};i[n].stopEvent=function(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}};e.Miniscroll=i})(window,document,"prototype");
