/*!
 * Miniscroll small plugin of scrollbar desktop and mobile
 *
 * @author Roger Luiz <http://rogerluizm.com.br/>
 *					  <http://miniscroll.rogerluizm.com.br>
 *
 * @copyright (c) 2011, 2012 <http://rogerluizm.com.br/>
 *
 * @version 1.2.9
 *		update 1.2.9 | 10/09/2013 - fix multidimensional scrollwheel
 *		update 1.2.9 | 10/09/2013 - fix error in the scroll when the position is relative or absolute
 *		update 1.2.9 | 10/09/2013 - fix updating on the x axis
 *		update 1.2.8 | 03/09/2013 - add turn off mousewheel, ex: { mousewheel: true }
 *		update 1.2.7 | 03/09/2013 - add scrollTo, now its posible scroll to a custom position
 *		update 1.2.6 | 21/06/2013 - fix bug the whole scrollbar (not just the handler part) moves down when I drag it.
 *		update 1.2.5 | 18/05/2013 - fix bug thumb position with arrow keys
 * 		update 1.2.4 | 18/05/2013 - fix error it's time to catching the width and height
 * 		update 1.2.3 | 18/05/2013 - fix scrollbar position "x"
 * 		update 1.2.2 | 17/05/2013 - Key event added, now you can press the key down and key up for scrolling
 * 		update 1.2.1 | 15/05/2013 - Touch event added, now works for ipad, iphone and android
 */
(function(j,k,l){var m={touchEvents:('ontouchstart'in k.documentElement)},Miniscroll=function(a,b){this.type="";this.is="static";this.target=this.getElement(a);this.container;this.tracker;this.thumb;this.thumb_delta=new Point(0,0);this.thumb_pos=new Point(0,0);this.touch=new Point(0,0);this.settings=b;this.percent;this.keypos_thumb=new Point(0,0);this.scrolling=false;this.preventScrolling=false;this.turnOffWheel=true;this.initializing()},Point=function(x,y){this.x=x!=null?x:0;this.y=y!=null?y:0;return{x:this.x,y:this.y}};Miniscroll[l].initializing=function(){this.buildScrollbar();this.buildScrollbarTracker();this.buildScrolbarThumb();this.settings.isKeyEvent=(typeof this.settings.isKeyEvent==="undefined")?true:this.settings.isKeyEvent;this.turnOffWheel=(typeof this.settings.turnOffWheel==="undefined")?this.turnOffWheel:this.settings.turnOffWheel;if(this.settings.isKeyEvent)this.addKeyBoardEvent();(!m.touchEvents)?this.setupEventHandler():this.setupTouchEvent();var a=this;j.setInterval(function(){a.update()},10)};Miniscroll[l].buildScrollbar=function(){var a=(this.target.id)?this.target.id:this.target.className;this.container=this.create(this.target,"div",{"class":"miniscroll-container","id":"miniscroll-"+a});var b=(this.settings.scrollbarSize)?this.settings.scrollbarSize:this.offset(this.target).height;var c=(this.settings.scrollbarSize)?this.settings.scrollbarSize:this.offset(this.target).width;var d=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size);var e=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{position:"absolute",visibility:"hidden",width:((this.settings.axis==="x")?c:this.settings.size)+"px",height:((this.settings.axis==="y")?b:this.settings.size)+"px",top:((this.settings.axis==="y")?this.offset(this.target).top:e)+"px",left:((this.settings.axis==="x")?this.offset(this.target).left:d)+"px",zIndex:999})};Miniscroll[l].buildScrollbarTracker=function(){this.tracker=this.create(this.container,"div",{"class":"miniscroll-tracker"});var a=(this.settings.axis==="x")?this.offset(this.container).width:this.settings.size;var b=(this.settings.axis==="y")?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:a+"px",height:b+"px",backgroundColor:this.settings.trackerColor?this.settings.trackerColor:"#067f41"})};Miniscroll[l].buildScrolbarThumb=function(){this.thumb=this.create(this.container,"div",{"class":"miniscroll-thumb"});var a=new Point((this.offset(this.container).width*this.offset(this.tracker).width)/this.target.scrollWidth,(this.offset(this.container).height*this.offset(this.tracker).height)/this.target.scrollHeight);var a=new Point((this.offset(this.container).width*this.offset(this.tracker).width)/this.target.scrollWidth,(this.offset(this.container).height*this.offset(this.tracker).height)/this.target.scrollHeight);var b=new Point((this.settings.sizethumb===undefined||this.settings.sizethumb==='auto')?a.x:this.settings.sizethumb,(this.settings.sizethumb===undefined||this.settings.sizethumb==='auto')?a.y:this.settings.sizethumb);this.css(this.thumb,{position:"absolute",top:0+"px",left:0+"px",width:((this.settings.axis==="x")?b.x:this.settings.size)+"px",height:((this.settings.axis==="y")?b.y:this.settings.size)+"px",backgroundColor:this.settings.thumbColor?this.settings.thumbColor:"#2AD47D"})};Miniscroll[l].setupEventHandler=function(){this.bind(this.thumb,"mousedown",this.onScrollThumbPress);this.bind(this.tracker,'mousedown',this.onScrollTrackerPress);if(this.turnOffWheel){this.bind(this.target,'mousewheel',this.onScrollThumbWheel)}};Miniscroll[l].setupTouchEvent=function(){this.bind(this.target,"touchstart",this.onScrollTouchStart);this.bind(this.target,"touchmove",this.onScrollTouchMove)};Miniscroll[l].updateContainerPosition=function(){this.is=this.getCss(this.target,'position');if(this.is==="relative"||this.is==="absolute"){if(this.settings.axis==="y"){this.container.style.top=this.target.scrollTop+"px";this.container.style.left=(this.offset(this.target).width-this.settings.size)+"px"}else{this.container.style.top=(this.offset(this.target).height-this.settings.size)+"px";this.container.style.left=this.target.scrollLeft+"px"}}else{if(this.settings.axis==="y"){this.container.style.top=this.offset(this.target).top+"px"}else{this.container.style.left=this.offset(this.target).left+"px"}}}Miniscroll[l].setScrubPosition=function(a){var b=this.offset(this.container).width,container_height=this.offset(this.container).height;var c=this.offset(this.thumb).width,thumb_height=this.offset(this.thumb).height;this.thumb_pos=new Point(Math.round((b-c)*a),Math.round((container_height-thumb_height)*a));if(this.settings.axis==='y'){this.thumb.style.top=Math.round(this.thumb_pos.y)+'px'}else{this.thumb.style.left=Math.round(this.thumb_pos.x)+'px'}}Miniscroll[l].addKeyBoardEvent=function(){this.target.setAttribute("tabindex","-1");this.css(this.target,{"outline":"none"});this.bind(this.target,"focus",function(c,d){this.bind(d,"keydown",function(a){var b=a.keyCode||a.which,arrow={left:37,up:38,right:39,down:40};switch(b){case arrow.up:if(this.percent!==0)this.keypos_thumb.y-=10;break;case arrow.down:if(this.percent!==1)this.keypos_thumb.y+=10;break;case arrow.left:if(this.percent!==0)this.keypos_thumb.x-=10;break;case arrow.right:if(this.percent!==1)this.keypos_thumb.x+=10;break}if(this.settings.axis==='y'){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);this.setScrubPosition(this.percent);this.target.scrollTop=this.keypos_thumb.y}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);this.setScrubPosition(this.percent);this.target.scrollLeft=this.keypos_thumb.x}if(this.percent>=1||this.percent<=0){this.preventScrolling=true}else{this.preventScrolling=false}this.updateContainerPosition()})});this.bind(this.target,"click",function(a,b){k.activeElement=b;b.focus()})};Miniscroll[l].onScrollTouchStart=function(a){var b=a.touches[0];this.scrolling=true;this.touch=new Point(b.pageX,b.pageY);this.bind(this.target,"touchend",this.onScrollTouchEnd)};Miniscroll[l].onScrollTouchMove=function(a){var b=a.touches[0];a.preventDefault();var c=new Point(this.touch.x-b.pageX,this.touch.y-b.pageY);this.touch=new Point(b.pageX,b.pageY);if(this.settings.axis==="y"){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);this.setScrubPosition(this.percent);this.target.scrollTop=this.target.scrollTop+c.y}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);this.setScrubPosition(this.percent);this.target.scrollLeft=this.target.scrollLeft+c.x}this.updateContainerPosition()};Miniscroll[l].onScrollTouchEnd=function(a){this.scrolling=false;this.unbind(this.target,"touchend",this.onScrollTouchEnd)};Miniscroll[l].onScrollThumbPress=function(a){a=a?a:j.event;this.stopEvent(a);this.scrolling=true;this.thumb_delta=new Point(this.thumb_pos.x-this.mouse(a).x,this.thumb_pos.y-this.mouse(a).y);this.bind(k,"mousemove",this.onScrollThumbUpdate);this.bind(k,"mouseup",this.onScrollThumbRelease);this.updateContainerPosition()};Miniscroll[l].onScrollThumbUpdate=function(a){a=a?a:j.event;this.stopEvent(a);if(!this.scrolling)return false;this.thumb_pos=new Point(this.mouse(a).x+this.thumb_delta.x,this.mouse(a).y+this.thumb_delta.y);this.thumb_pos=new Point(Math.max(0,Math.min(this.container.offsetWidth-this.thumb.offsetWidth,this.thumb_pos.x)),Math.max(0,Math.min(this.container.offsetHeight-this.thumb.offsetHeight,this.thumb_pos.y)));this.percent=new Point(this.thumb_pos.x/(this.container.offsetWidth-this.thumb.offsetWidth),this.thumb_pos.y/(this.container.offsetHeight-this.thumb.offsetHeight));this.percent=new Point(Math.max(0,Math.min(1,this.percent.x)),Math.max(0,Math.min(1,this.percent.y)));if(this.settings.axis==="y"){this.thumb.style.top=Math.round(this.thumb_pos.y)+'px';this.target.scrollTop=Math.round((this.target.scrollHeight-this.target.offsetHeight)*this.percent.y)}else{this.thumb.style.left=Math.round(this.thumb_pos.x)+'px';this.target.scrollLeft=Math.round((this.target.scrollWidth-this.target.offsetWidth)*this.percent.x)}this.keypos_thumb=new Point(this.target.scrollLeft,this.target.scrollTop);this.updateContainerPosition()};Miniscroll[l].onScrollThumbWheel=function(a){a=a?a:j.event;if(!this.preventScrolling)this.stopEvent(a);var b=a||j.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;if(b.wheelDelta){delta=b.wheelDelta/120}if(b.detail){delta=-b.detail/3}deltaY=delta;deltaX=delta;if(b.axis!==undefined&&b.axis===b.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta}if(b.wheelDeltaY!==undefined){deltaY=b.wheelDeltaY/120}if(b.wheelDeltaX!==undefined){deltaX=-1*b.wheelDeltaX/120}if(this.settings.axis==='y'){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);this.setScrubPosition(this.percent);this.target.scrollTop=Math.round(this.target.scrollTop-deltaY*10))}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);this.setScrubPosition(this.percent);this.target.scrollLeft=Math.round(this.target.scrollLeft-deltaX*10))}if(this.percent>=1||this.percent<=0){this.preventScrolling=true}else{this.preventScrolling=false}this.keypos_thumb=new Point(this.target.scrollLeft,this.target.scrollTop);this.updateContainerPosition()};Miniscroll[l].onScrollThumbRelease=function(a){a=a?a:j.event;this.stopEvent(a);this.scrolling=false;this.unbind(k,"mousemove",this.onScrollThumbUpdate);this.unbind(k,"mouseup",this.onScrollThumbRelease)};Miniscroll[l].onScrollTrackerPress=function(a){var b=this.mouse(a).y-this.offset(this.container).top;this.scrolling=true;this.scrollTo(b)};Miniscroll[l].scrollTo=function(a){var b=Math.max(0,Math.min(this.offset(this.target).height-this.offset(this.thumb).height,a));if(this.settings.axis==='y'){this.thumb_pos.y=b;this.thumb.style.top=Math.round(this.thumb_pos.y)+"px";this.target.scrollTop=b;this.scrolling=false}};Miniscroll[l].update=function(){if(this.settings.axis==='y'){if(this.target.scrollHeight===this.offset(this.target).height){this.css(this.container,{"visibility":"hidden"})}else{this.css(this.container,{"visibility":"visible"})}}else{if(this.target.scrollWidth===this.offset(this.target).width){this.css(this.container,{"visibility":"hidden"})}else{this.css(this.container,{"visibility":"visible"})}}var a=(this.settings.scrollbarSize)?this.settings.scrollbarSize:this.offset(this.target).height;var b=(this.settings.scrollbarSize)?this.settings.scrollbarSize:this.offset(this.target).width;var c=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size);var d=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{width:((this.settings.axis==="x")?b:this.settings.size)+"px",height:((this.settings.axis==="y")?a:this.settings.size)+"px",top:((this.settings.axis==="y")?this.offset(this.target).top:d)+"px",left:((this.settings.axis==="x")?this.offset(this.target).left:c)+"px",});var e=(this.settings.axis==="x")?this.offset(this.container).width:this.settings.size;var f=(this.settings.axis==="y")?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:e+"px",height:f+"px"});var g=new Point((this.offset(this.container).width*this.offset(this.tracker).width)/this.target.scrollWidth,(this.offset(this.container).height*this.offset(this.tracker).height)/this.target.scrollHeight);var h=new Point((this.settings.sizethumb===undefined||this.settings.sizethumb==='auto')?g.x:this.settings.sizethumb,(this.settings.sizethumb===undefined||this.settings.sizethumb==='auto')?g.y:this.settings.sizethumb);this.css(this.thumb,{width:((this.settings.axis==="x")?h.x:this.settings.size)+"px",height:((this.settings.axis==="y")?h.y:this.settings.size)+"px"});if(this.settings.axis==='y'){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);if(!this.scrolling){this.setScrubPosition(this.percent)}}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);if(!this.scrolling){this.setScrubPosition(this.percent)}}this.updateContainerPosition()};Miniscroll[l].getElement=function(a){var b,$=this;if(a===j||a===k||a==="body"||a==="body, html"){return k.body}if(typeof a==='string'||a instanceof String){var c=a.replace(/^\s+/,'').replace(/\s+$/,''),b;if(c.indexOf("#")>-1){this.type='id';var d=c.split('#');b=k.getElementById(d[1])}if(c.indexOf(".")>-1){this.type='class';var d=c.split('.'),tags=k.getElementsByTagName('*'),len=tags.length,found=[],count=0;for(var i=0;i<len;i++){if(tags[i].className&&tags[i].className.match(new RegExp("(^|\\s)"+d[1]+"(\\s|$)"))){b=tags[i]}}}return b}else{return a}};Miniscroll[l].create=function(a,b,c){var d=k.createElement(b);if(c){for(var e in c){if(c.hasOwnProperty(e)){d.setAttribute(e,c[e])}}a.appendChild(d)}return d};Miniscroll[l].css=function(a,b){for(var c in b){if(c==='opacity'){a.style.filter='alpha(opacity='+(b[c]*100)+')';a.style.KhtmlOpacity=b[c];a.style.MozOpacity=b[c];a.style.opacity=b[c]}else{a.style[c]=b[c]}}};Miniscroll[l].getCss=function(a,b){var c;if(!j.getComputedStyle){if(k.defaultView&&k.defaultView.getComputedStyle){c=k.defaultView.getComputedStyle.getPropertyValue(b)}else{if(a.currentStyle){c=a.currentStyle[b]}else{c=a.style[b]}}}else{c=j.getComputedStyle(a).getPropertyValue(b)}return c};Miniscroll[l].offset=function(a){var b=a.offsetTop,left=a.offsetLeft;var c=a.offsetHeight;if(typeof a.offsetHeight==="undefined"){c=parseInt(this.getCss(a,"height"))}var d=a.offsetWidth;if(typeof a.offsetWidth==="undefined"){d=parseInt(this.getCss(a,"width"))}return{top:b,left:left,width:d,height:c}};Miniscroll[l].mouse=function(a){var b=0,posy=0;if(a.pageX||a.pageY){b=a.pageX;posy=a.pageY}else if(a.clientX||a.clientY){b=a.clientX+k.body.scrollLeft+k.documentElement.scrollLeft;posy=a.clientY+k.body.scrollTop+k.documentElement.scrollTop}return{x:b,y:posy}};Miniscroll[l].bind=function(b,c,d){var e=(/Firefox/i.test(navigator.userAgent))?"DOMMouseScroll":"mousewheel";var f=this;if(b.addEventListener){if(c==="mousewheel"){b.addEventListener(e,function(a){d.call(f,a,this)},false)}else{b.addEventListener(c,function(a){d.call(f,a,this)},false)}}else if(b.attachEvent){b.attachEvent('on'+c,function(a){d.call(f,a,this)})}else{b['on'+c]=function(a){d.call(f,a,this)}}};Miniscroll[l].unbind=function(b,c,d){var e=(/Firefox/i.test(navigator.userAgent))?"DOMMouseScroll":"mousewheel";if(b.addEventListener){if(c==="mousewheel"){b.removeEventListener(e,function(a){d.call(_this,a,this)},false)}else{b.removeEventListener(c,function(a){d.call(_this,a,this)},false)}}else if(b.attachEvent){b.detachEvent('on'+c,function(a){d.call(_this,a,this)})}else{b['on'+c]=null}};Miniscroll[l].stopEvent=function(a){if(a.stopPropagation){a.stopPropagation()}else{a.cancelBubble=true}if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}};j.Miniscroll=Miniscroll})(window,document,"prototype");;