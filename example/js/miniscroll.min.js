/**
 * Scrollbar javascript
 *
 * @author	Roger Luiz (mail@rogerluizm.com.br);
 *			miniscroll.rogerluizm.com.br
 *			miniscroll.rogerluizm.com.br/docs/index.html
 *
 * @size 22.11.2011
 *		24.11.2011 (added hide and show scrollbar)
 *		06.12.2011 (bug touchEvent corrected)
 *		06.12.2011 (added easing animation of touch scroll)
 * 		12.01.2012 (added cross browser parentElem)
 *		09.02.2012 (update plugin and remove bugs of IE)
 *
 * @version	1.1v
 * @copyright (c) 2011
 */function get_id(a){return document.getElementById(a)}var miniscroll={content:null,current:null,tracker:null,scrub:null,args:{},axis:"",scrollRect:{},dragging:!1,startPos:{},touchPos:{},setTimeInterval:null,animInt:null,size:10,targetTouch:null,interval:null,count:0,startPos:{},lastPos:{},speed:0,init:function(a,b){this.content=get_id(a);this.args=b;this.size=b.size===undefined?10:b.size;this.addMiniScroll(this.content);if(this.isMiniTouchDevice())this.addMiniEvent(this.content,"touchstart",this.startTouch);else{this.addMiniEvent(this.content,"mousewheel",this.wheelEvent);this.addMiniEvent(this.scrub,"mousedown",this.startEvent)}var c=[this.content,this.tracker,this.scrub];this.setTimeInterval=window.setInterval(function(){miniscroll.updateScroll(miniscroll.args.scroll,c,miniscroll.size)},100)},updateScroll:function(a,b,c){if(a=="x"){miniscroll.updateMiniScroll(b,"x",c);b[1].offsetWidth==b[2].offsetWidth?miniscroll.hide(b[1],b[2]):miniscroll.show(b[1],b[2])}else{miniscroll.updateMiniScroll(b,"y",c);b[1].offsetHeight==b[2].offsetHeight?miniscroll.hide(b[1],b[2]):miniscroll.show(b[1],b[2])}},hide:function(a,b){a.style.visibility="hidden";b.style.visibility="hidden"},show:function(a,b){a.style.visibility="visible";b.style.visibility="visible"},startTouch:function(a){var b=miniscroll;b.animInt!=null&&clearInterval(b.animInt);b.touchPos={x:this.scrollLeft+a.touches[0].clientX,y:this.scrollTop+a.touches[0].clientY};b.getCurrent(this);b.getAxis(b.tracker);b.targetTouch=a.targetTouches[0].target;count=0;interval=setInterval(function(){count++},200);b.addMiniEvent(this,"touchmove",b.moveTouch);b.addMiniEvent(this,"touchend",b.stopTouch);b.preventEvent(a)},moveTouch:function(a){var b=miniscroll,c={x:this.scrollWidth-this.offsetWidth,y:this.scrollHeight-this.offsetHeight},d={x:b.tracker.offsetWidth-b.scrub.offsetWidth,y:b.tracker.offsetHeight-b.scrub.offsetHeight},e={x:this.scrollLeft/c.x*d.x,y:this.scrollTop/c.y*d.y};b.lastPos={x:b.startPos.x,y:b.startPos.y};b.startPos={x:b.touchPos.x-a.touches[0].clientX,y:b.touchPos.y-a.touches[0].clientY};b.speed={x:b.startPos.x-b.lastPos.x,y:b.startPos.y-b.lastPos.y};if(b.axis=="x"){this.scrollLeft=b.touchPos.x-a.touches[0].clientX;b.scrub.style.left=e.x+this.offsetLeft+"px"}else{this.scrollTop=b.touchPos.y-a.touches[0].clientY;b.scrub.style.top=e.y+this.offsetTop+"px"}b.preventEvent(a)},stopTouch:function(a){var b=miniscroll;b.animInt=setInterval(function(){var a={x:b.current.scrollWidth-b.current.offsetWidth,y:b.current.scrollHeight-b.current.offsetHeight},c={x:b.tracker.offsetWidth-b.scrub.offsetWidth,y:b.tracker.offsetHeight-b.scrub.offsetHeight},d={x:b.current.scrollLeft/a.x*c.x,y:b.current.scrollTop/a.y*c.y},e={x:b.current.scrollLeft,y:b.current.scrollTop},f={x:e.x+b.speed.x,y:e.y+b.speed.y};b.speed={x:b.speed.x*.96,y:b.speed.y*.96};if(b.axis=="x"){b.current.scrollLeft=f.x;b.scrub.style.left=d.x+b.current.offsetLeft+"px";b.speed==0&&clearInterval(b.animInt)}else{b.current.scrollTop=f.y;document.getElementById("trace").innerHTML=b.current.scrollTop;b.scrub.style.top=d.y+b.current.offsetTop+"px";b.speed==0&&clearInterval(b.animInt)}},30);b.removeMiniEvent(this,"touchmove",b.moveTouch);b.removeMiniEvent(this,"touchend",b.moveTouch);clearInterval(interval);count<1&&b.dispatchMiniEvent(a,b.targetTouch)},startEvent:function(a){var b=miniscroll,c=window.event?window.event:a,d=window.event?a.srcElement:a.target,e=d.parentElement;e||(e=d.parentNode);b.getCurrent(e);b.getAxis(b.tracker);b.dragging=!0;var f=b.current,g=b.scrub,h=b.tracker,i=b.getMouseCords(a);b.startPos={x:i.x-parseInt(g.style.left),y:i.y-parseInt(g.style.top)};b.axis==="x"?b.scrollRect={x:f.offsetLeft,y:0,width:h.offsetWidth+f.offsetLeft-g.offsetWidth,height:0}:b.scrollRect={x:0,y:f.offsetTop,width:0,height:h.offsetHeight+f.offsetTop-g.offsetHeight};b.addMiniEvent(document,"mousemove",b.moveEvent);b.addMiniEvent(document,"mouseup",b.stopEvent);b.preventEvent(c)},moveEvent:function(a){var b=miniscroll;if(b.dragging){var c=window.event?window.event:a,d=b.getMouseCords(a),e=b.current,f=b.scrub,g=b.tracker,h={x:d.x-b.startPos.x,y:d.y-b.startPos.y},i={x:h.x/f.offsetWidth*f.offsetWidth,y:h.y/f.offsetHeight*f.offsetHeight},j={x:g.offsetWidth-f.offsetWidth+e.offsetLeft,y:g.offsetHeight-f.offsetHeight+e.offsetTop};if(b.axis==="x"){i.x<=e.offsetLeft?f.style.left=e.offsetLeft+"px":i.x>=j.x?f.style.left=j.x+"px":f.style.left=i.x+"px";e.scrollLeft=b.getScrollTo("x")}else{i.y<=e.offsetTop?f.style.top=e.offsetTop+"px":i.y>=j.y?f.style.top=j.y+"px":f.style.top=i.y+"px";e.scrollTop=b.getScrollTo("y")}b.preventEvent(c)}},wheelEvent:function(a){var b=miniscroll,c=window.event?window.event:a,d=-(c.detail?c.detail*-120:c.wheelDelta);d==0?b.dragging=!1:b.dragging=!0;b.getCurrent(this);var e=b.scrub,f=b.tracker,g={x:this.scrollWidth-this.offsetWidth,y:this.scrollHeight-this.offsetHeight},h={x:f.offsetWidth-e.offsetWidth,y:f.offsetHeight-e.offsetHeight};if(b.axis=="x"){this.scrollLeft+=d;e.style.left=this.offsetLeft+this.scrollLeft/g.x*h.x+"px"}else{this.scrollTop+=d;e.style.top=this.offsetTop+this.scrollTop/g.y*h.y+"px"}b.preventEvent(c)},stopEvent:function(a){var b=miniscroll,c=window.event?window.event:a;b.dragging=!1;b.removeMiniEvent(document,"mousemove",b.moveEvent);b.removeMiniEvent(document,"mouseup",b.stopEvent)},preventEvent:function(a){a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();a.cancelBubble=!0;a.cancel=!0;a.returnValue=!1;return!1},updateMiniScroll:function(a,b,c){switch(b){case"x":var d=a[0].offsetLeft,e=a[0].offsetTop+a[0].offsetHeight-c,f=a[0].offsetWidth,g=c,h=a[2].offsetLeft,i=a[0].offsetWidth*a[1].offsetWidth/a[0].scrollWidth;miniscroll.updateMiniCss(a[1],[d,e,f,g]);miniscroll.updateMiniCss(a[2],[h,e,i,g]);break;case"y":var d=a[0].offsetLeft+a[0].offsetWidth-c,e=a[0].offsetTop,f=c,g=a[0].offsetHeight,j=a[2].offsetTop,k=a[0].offsetHeight*a[1].offsetHeight/a[0].scrollHeight;miniscroll.updateMiniCss(a[1],[d,e,f,g]);miniscroll.updateMiniCss(a[2],[d,j,f,k])}},updateMiniCss:function(a,b){a.style.top=b[1]+"px";a.style.left=b[0]+"px";a.style.width=b[2]+"px";a.style.height=b[3]+"px"},getCurrent:function(a){var b=miniscroll;b.current=a;b.tracker=get_id("tracker_"+b.current.id);b.scrub=get_id("scrub_"+b.current.id)},getAxis:function(a){this.axis=a.offsetWidth<a.offsetHeight?"y":"x"},getMouseCords:function(a){var b=a||window.event,c={x:0,y:0};if(a.pageX||a.pageY){c.x=a.pageX;c.y=a.pageY}else{c.x=a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft;c.y=a.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop}return c},getScrollTo:function(a){var b=this.current,c=this.scrub,d=this.tracker;if(a==="x"){var e=(c.offsetLeft-b.offsetLeft)/(d.offsetWidth-c.offsetWidth);return e*(b.scrollWidth-b.offsetWidth)}var f=(c.offsetTop-b.offsetTop)/(d.offsetHeight-c.offsetHeight);return f*(b.scrollHeight-b.offsetHeight)},addMiniScroll:function(a){var b=miniscroll,c=b.args.size===undefined?10:b.args.size;switch(b.args.scroll){case"x":var d=a.offsetTop+a.offsetHeight-c;b.addMiniTracker(a,a.offsetLeft,d,a.offsetWidth,c);var e=a.offsetWidth*b.tracker.offsetWidth/a.scrollWidth;b.addMiniScrub(a,a.offsetLeft,d,a.offsetWidth,c);break;case"y":var f=a.offsetLeft+a.offsetWidth-c;b.addMiniTracker(a,f,a.offsetTop,c,a.offsetHeight);var g=a.offsetHeight*b.tracker.offsetHeight/a.scrollHeight;b.addMiniScrub(a,f,a.offsetTop,c,g)}},addMiniTracker:function(a,b,c,d,e){var f=miniscroll,g=f.args.alpha===undefined?.6:f.args.alpha,h="tracker_"+a.id,i=document.createElement("div");i.setAttribute("id",h);a.appendChild(i);f.tracker=get_id(h);f.addCss(f.tracker,{left:b+"px",top:c+"px",width:d+"px",height:e+"px",position:"absolute",background:f.args.color});f.addOpacity(f.tracker,g);f.args.radius!==undefined&&f.addRadius(f.tracker,f.args.radius)},addMiniScrub:function(a,b,c,d,e){var f=miniscroll,g=f.args.scrubAlpha===undefined?1:f.args.scrubAlpha,h="scrub_"+a.id,i=document.createElement("div");i.setAttribute("id",h);a.appendChild(i);f.scrub=get_id(h);f.addCss(f.scrub,{left:b+"px",top:c+"px",width:d+"px",height:e+"px",position:"absolute",background:f.args.color});f.addOpacity(f.scrub,g);f.args.radius!==undefined&&f.addRadius(f.scrub,f.args.radius)},addRadius:function(a,b){a.style.borderRadius=b+"px";a.style.MozBorderRadius=b+"px";a.style.WebkitBorderRadius=b+"px";a.style.KhtmlBorderRadius=b+"px"},addOpacity:function(a,b){a.style.opacity=b;a.style.MozOpacity=b;a.style.WebkitOpacity=b;a.style.KhtmlOpacity=b;a.style.filter="progid:DXImageTransform.Microsoft.Alpha(Opacity="+b*100+")"},addCss:function(a,b){a.style.top=b.top;a.style.left=b.left;a.style.width=b.width;a.style.height=b.height;a.style.position=b.position;a.style.backgroundColor=b.background},addMiniEvent:function(a,b,c){if(a.addEventListener){b==="mousewheel"?a.addEventListener("DOMMouseScroll",c,!0):a.addEventListener(b,c,!1);this.addMiniEvent=function(a,b,c){a.addEventListener(b,c,!1)}}else if(a.attachEvent){a.attachEvent("on"+b,c);this.addMiniEvent=function(a,b,c){a.attachEvent("on"+b,c)}}else{a["on"+b]=c;this.addMiniEvent=function(a,b,c){a["on"+b]=c}}},removeMiniEvent:function(a,b,c){if(a.addEventListener){b==="mousewheel"?a.removeEventListener("DOMMouseScroll",c,!0):a.removeEventListener(b,c,!1);this.removeMiniEvent=function(a,b,c){a.removeEventListener(b,c,!1)}}else a.attachEvent&&(this.removeMiniEvent=function(a,b,c){var d=b+c;a.detachEvent("on"+b,a[d]);a[d]=null;a["e"+d]=null})},dispatchMiniEvent:function(a,b){if(document.dispatchEvent){var c=document.createEvent("MouseEvents");c.nitMouseEvent(a,!0,!0,window,1,1,1,1,1,!1,!1,!1,!1,0,b);b.dispatchEvent(c)}else document.fireEvent&&b.fireEvent("on"+a)},isMiniTouchDevice:function(){return"ontouchstart"in window}};