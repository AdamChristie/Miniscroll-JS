/*!
 * Miniscroll small plugin of scrollbar desktop and mobile
 *
 * @author Roger Luiz <http://rogerluizm.com.br/>
 *					  <http://miniscroll.rogerluizm.com.br>
 *
 * @copyright (c) 2011, 2012 <http://rogerluizm.com.br/>
 *
 * @version 1.2.5
 * 		update 1.2.1 | 15/05/2013 - Touch evento adicionado, agora funciona para ipad, iphone e android 
 * 		update 1.2.2 | 17/05/2013 - Adicionado key event, setas do teclado tanto para cima quando para baixo
 * 		update 1.2.3 | 18/05/2013 - scrollbar horizontal e vertical atualizado fixbug posição "x"
 * 		update 1.2.4 | 18/05/2013 - fixbug scrollbar, estava dando um erro na hora de pegar a altura ou largura
 * 		update 1.2.5 | 18/05/2013 - fixbug da posição do thumb quando utilizado os key arrows
 */
(function(e,t){var n={touchEvents:"ontouchstart"in t.documentElement},r=function(e,t){this.type="";this.is="static";this.target=this.getElement(e);this.container;this.tracker;this.thumb;this.thumb_delta=new Point(0,0);this.thumb_pos=new Point(0,0);this.touch=new Point(0,0);this.settings=t;this.percent;this.keypos_thumb=new Point(0,0);this.scrolling=false;this.preventScrolling=false;this.initializing()};r.prototype.initializing=function(){this.buildScrollbar();this.buildScrollbarTracker();this.buildScrolbarThumb();this.settings.isKeyEvent=typeof this.settings.isKeyEvent==="undefined"?true:this.settings.isKeyEvent;if(this.settings.isKeyEvent)this.addKeyBoardEvent();!n.touchEvents?this.setupEventHandler():this.setupTouchEvent();var t=this;e.setInterval(function(){t.update()},10)};r.prototype.buildScrollbar=function(){var e=this.target.id?this.target.id:this.target.className;this.container=this.create(this.target,"div",{"class":"miniscroll-container",id:"miniscroll-"+e});var t=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).height;var n=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).width;var r=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size);var i=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{position:"absolute",visibility:"hidden",width:(this.settings.axis==="x"?n:this.settings.size)+"px",height:(this.settings.axis==="y"?t:this.settings.size)+"px",top:(this.settings.axis==="y"?this.offset(this.target).top:i)+"px",left:(this.settings.axis==="x"?this.offset(this.target).left:r)+"px",zIndex:999})};r.prototype.buildScrollbarTracker=function(){this.tracker=this.create(this.container,"div",{"class":"miniscroll-tracker"});var e=this.settings.axis==="x"?this.offset(this.container).width:this.settings.size;var t=this.settings.axis==="y"?this.offset(this.container).height:this.settings.size;console.log(this.offset(this.target).height);this.css(this.tracker,{width:e+"px",height:t+"px",backgroundColor:this.settings.trackerColor?this.settings.trackerColor:"#067f41"})};r.prototype.buildScrolbarThumb=function(){this.thumb=this.create(this.container,"div",{"class":"miniscroll-thumb"});var e=new Point(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight);var e=new Point(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight);var t=new Point(this.settings.sizethumb===undefined||this.settings.sizethumb==="auto"?e.x:this.settings.sizethumb,this.settings.sizethumb===undefined||this.settings.sizethumb==="auto"?e.y:this.settings.sizethumb);this.css(this.thumb,{position:"absolute",top:0+"px",left:0+"px",width:(this.settings.axis==="x"?t.x:this.settings.size)+"px",height:(this.settings.axis==="y"?t.y:this.settings.size)+"px",backgroundColor:this.settings.thumbColor?this.settings.thumbColor:"#2AD47D"})};r.prototype.setupEventHandler=function(){this.bind(this.thumb,"mousedown",this.onScrollThumbPress);this.bind(this.target,"mousewheel",this.onScrollThumbWheel)};r.prototype.setupTouchEvent=function(){this.bind(this.target,"touchstart",this.onScrollTouchStart);this.bind(this.target,"touchmove",this.onScrollTouchMove)};r.prototype.updateContainerPosition=function(){this.is=this.getCss(this.target,"position");if(this.is==="relative"||this.is==="absolute"){if(this.settings.axis==="y"){this.container.style.top=this.target.scrollTop+"px"}else{this.container.style.left=this.target.scrollLeft+"px"}}};r.prototype.setScrubPosition=function(e){var t=this.offset(this.container).width,n=this.offset(this.container).height;var r=this.offset(this.thumb).width,i=this.offset(this.thumb).height;this.thumb_pos=new Point(Math.round((t-r)*e),Math.round((n-i)*e));if(this.settings.axis==="y"){this.thumb.style.top=Math.round(this.thumb_pos.y)+"px"}else{this.thumb.style.left=Math.round(this.thumb_pos.x)+"px"}};r.prototype.addKeyBoardEvent=function(){this.target.setAttribute("tabindex","-1");this.css(this.target,{outline:"none"});this.bind(this.target,"focus",function(e,t){this.bind(t,"keydown",function(e){var t=e.keyCode||e.which,n={left:37,up:38,right:39,down:40};switch(t){case n.up:if(this.percent!==0)this.keypos_thumb.y-=10;break;case n.down:if(this.percent!==1)this.keypos_thumb.y+=10;break;case n.left:if(this.percent!==0)this.keypos_thumb.x-=10;break;case n.right:if(this.percent!==1)this.keypos_thumb.x+=10;break}if(this.settings.axis==="y"){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);this.setScrubPosition(this.percent);this.target.scrollTop=this.keypos_thumb.y}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);this.setScrubPosition(this.percent);this.target.scrollLeft=this.keypos_thumb.x}if(this.percent>=1||this.percent<=0){this.preventScrolling=true}else{this.preventScrolling=false}this.updateContainerPosition()})});this.bind(this.target,"click",function(e,n){t.activeElement=n;n.focus()})};r.prototype.onScrollTouchStart=function(e){var t=e.touches[0];this.scrolling=true;this.touch=new Point(t.pageX,t.pageY);this.bind(this.target,"touchend",this.onScrollTouchEnd)};r.prototype.onScrollTouchMove=function(e){var t=e.touches[0];e.preventDefault();var n=new Point(this.touch.x-t.pageX,this.touch.y-t.pageY);this.touch=new Point(t.pageX,t.pageY);if(this.settings.axis==="y"){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);this.setScrubPosition(this.percent);this.target.scrollTop=this.target.scrollTop+n.y}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);this.setScrubPosition(this.percent);this.target.scrollLeft=this.target.scrollLeft+n.x}this.updateContainerPosition()};r.prototype.onScrollTouchEnd=function(e){this.scrolling=false;this.unbind(this.target,"touchend",this.onScrollTouchEnd)};r.prototype.onScrollThumbPress=function(n){n=n?n:e.event;this.stopEvent(n);this.scrolling=true;this.thumb_delta=new Point(this.thumb_pos.x-this.mouse(n).x,this.thumb_pos.y-this.mouse(n).y);this.bind(t,"mousemove",this.onScrollThumbUpdate);this.bind(t,"mouseup",this.onScrollThumbRelease);this.updateContainerPosition()};r.prototype.onScrollThumbUpdate=function(t){t=t?t:e.event;this.stopEvent(t);if(!this.scrolling)return false;this.thumb_pos=new Point(this.mouse(t).x+this.thumb_delta.x,this.mouse(t).y+this.thumb_delta.y);this.thumb_pos=new Point(Math.max(0,Math.min(this.container.offsetWidth-this.thumb.offsetWidth,this.thumb_pos.x)),Math.max(0,Math.min(this.container.offsetHeight-this.thumb.offsetHeight,this.thumb_pos.y)));this.percent=new Point(this.thumb_pos.x/(this.container.offsetWidth-this.thumb.offsetWidth),this.thumb_pos.y/(this.container.offsetHeight-this.thumb.offsetHeight));this.percent=new Point(Math.max(0,Math.min(1,this.percent.x)),Math.max(0,Math.min(1,this.percent.y)));if(this.settings.axis==="y"){this.thumb.style.top=Math.round(this.thumb_pos.y)+"px";this.target.scrollTop=Math.round((this.target.scrollHeight-this.target.offsetHeight)*this.percent.y)}else{this.thumb.style.left=Math.round(this.thumb_pos.x)+"px";this.target.scrollLeft=Math.round((this.target.scrollWidth-this.target.offsetWidth)*this.percent.x)}this.keypos_thumb=new Point(this.target.scrollLeft,this.target.scrollTop);this.updateContainerPosition()};r.prototype.onScrollThumbWheel=function(t){t=t?t:e.event;if(!this.preventScrolling)this.stopEvent(t);var n=t||e.event,r=[].slice.call(arguments,1),i=0,s=true,o=0,u=0;if(n.wheelDelta){i=n.wheelDelta/120}if(n.detail){i=-n.detail/3}u=i;if(n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS){u=0;o=-1*i}if(n.wheelDeltaY!==undefined){u=n.wheelDeltaY/120}if(n.wheelDeltaX!==undefined){o=-1*n.wheelDeltaX/120}if(this.settings.axis==="y"){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);this.setScrubPosition(this.percent);this.target.scrollTop=Math.round(this.target.scrollTop-i*10)}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);this.setScrubPosition(this.percent);this.target.scrollLeft=Math.round(this.target.scrollLeft-i*10)}if(this.percent>=1||this.percent<=0){this.preventScrolling=true}else{this.preventScrolling=false}this.keypos_thumb=new Point(this.target.scrollLeft,this.target.scrollTop);this.updateContainerPosition()};r.prototype.onScrollThumbRelease=function(n){n=n?n:e.event;this.stopEvent(n);this.scrolling=false;this.unbind(t,"mousemove",this.onScrollThumbUpdate);this.unbind(t,"mouseup",this.onScrollThumbRelease)};r.prototype.update=function(){if(this.target.scrollHeight===this.offset(this.target).height){this.css(this.container,{visibility:"hidden"})}else{this.css(this.container,{visibility:"visible"})}var e=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).height;var t=this.settings.scrollbarSize?this.settings.scrollbarSize:this.offset(this.target).width;var n=this.offset(this.target).left+(this.offset(this.target).width-this.settings.size);var r=this.offset(this.target).top+(this.offset(this.target).height-this.settings.size);this.css(this.container,{width:(this.settings.axis==="x"?t:this.settings.size)+"px",height:(this.settings.axis==="y"?e:this.settings.size)+"px",top:(this.settings.axis==="y"?this.offset(this.target).top:r)+"px",left:(this.settings.axis==="x"?this.offset(this.target).left:n)+"px"});var i=this.settings.axis==="x"?this.offset(this.container).width:this.settings.size;var s=this.settings.axis==="y"?this.offset(this.container).height:this.settings.size;this.css(this.tracker,{width:i+"px",height:s+"px"});var o=new Point(this.offset(this.container).width*this.offset(this.tracker).width/this.target.scrollWidth,this.offset(this.container).height*this.offset(this.tracker).height/this.target.scrollHeight);var u=new Point(this.settings.sizethumb===undefined||this.settings.sizethumb==="auto"?o.x:this.settings.sizethumb,this.settings.sizethumb===undefined||this.settings.sizethumb==="auto"?o.y:this.settings.sizethumb);this.css(this.thumb,{width:(this.settings.axis==="x"?u.x:this.settings.size)+"px",height:(this.settings.axis==="y"?u.y:this.settings.size)+"px"});if(this.settings.axis==="y"){this.percent=this.target.scrollTop/(this.target.scrollHeight-this.target.offsetHeight);if(!this.scrolling){this.setScrubPosition(this.percent)}}else{this.percent=this.target.scrollLeft/(this.target.scrollWidth-this.target.offsetWidth);if(!this.scrolling){this.setScrubPosition(this.percent)}}this.updateContainerPosition()};r.prototype.getElement=function(n){var r,i=this;if(n===e||n===t||n==="body"||n==="body, html"){return t.body}if(typeof n==="string"||n instanceof String){var s=n.replace(/^\s+/,"").replace(/\s+$/,""),r;if(s.indexOf("#")>-1){this.type="id";var o=s.split("#");r=t.getElementById(o[1])}if(s.indexOf(".")>-1){this.type="class";var o=s.split("."),u=t.getElementsByTagName("*"),a=u.length,f=[],l=0;for(var c=0;c<a;c++){if(u[c].className&&u[c].className.match(new RegExp("(^|\\s)"+o[1]+"(\\s|$)"))){r=u[c]}}}return r}else if(n instanceof jQuery){return n[0]}else{return n}};r.prototype.create=function(e,n,r){var i=t.createElement(n);if(r){for(var s in r){if(r.hasOwnProperty(s)){i.setAttribute(s,r[s])}}e.appendChild(i)}return i};r.prototype.css=function(e,t){for(var n in t){if(n==="opacity"){e.style.filter="alpha(opacity="+t[n]*100+")";e.style.KhtmlOpacity=t[n];e.style.MozOpacity=t[n];e.style.opacity=t[n]}else{e.style[n]=t[n]}}};r.prototype.getCss=function(n,r){var i;if(!e.getComputedStyle){if(t.defaultView&&t.defaultView.getComputedStyle){i=t.defaultView.getComputedStyle.getPropertyValue(r)}else{if(n.currentStyle){i=n.currentStyle[r]}else{i=n.style[r]}}}else{i=e.getComputedStyle(n).getPropertyValue(r)}return i};r.prototype.offset=function(e){var t=e.offsetTop,n=e.offsetLeft;var r=e.offsetHeight;if(typeof e.offsetHeight==="undefined"){r=parseInt(this.getCss(e,"height"))}var i=e.offsetWidth;if(typeof e.offsetWidth==="undefined"){i=parseInt(this.getCss(e,"width"))}return{top:t,left:n,width:i,height:r}};r.prototype.mouse=function(e){var n=0,r=0;if(e.pageX||e.pageY){n=e.pageX;r=e.pageY}else if(e.clientX||e.clientY){n=e.clientX+t.body.scrollLeft+t.documentElement.scrollLeft;r=e.clientY+t.body.scrollTop+t.documentElement.scrollTop}return{x:n,y:r}};r.prototype.bind=function(e,t,n){var r=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";var i=this;if(e.addEventListener){if(t==="mousewheel"){e.addEventListener(r,function(e){n.call(i,e,this)},false)}else{e.addEventListener(t,function(e){n.call(i,e,this)},false)}}else if(e.attachEvent){e.attachEvent("on"+t,function(e){n.call(i,e,this)})}else{e["on"+t]=function(e){n.call(i,e,this)}}};r.prototype.unbind=function(e,t,n){var r=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";if(e.addEventListener){if(t==="mousewheel"){e.removeEventListener(r,function(e){n.call(_this,e,this)},false)}else{e.removeEventListener(t,function(e){n.call(_this,e,this)},false)}}else if(e.attachEvent){e.detachEvent("on"+t,function(e){n.call(_this,e,this)})}else{e["on"+t]=null}};r.prototype.stopEvent=function(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}};e.Miniscroll=r})(window,document);var Point=function(){function e(e,t){this.x=e!=null?e:0;this.y=t!=null?t:0}e.prototype.x=0;e.prototype.y=0;e.prototype.reset=function(){this.x=0;this.y=0;return this};e.prototype.distanceTo=function(e){var t;t=e.x-this.x;t=t*t;var n;n=e.y-this.y;n=n*n;return Math.sqrt(t+n)};e.prototype.angleTo=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.atan2(t,n)};return e}()